<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeVuln</title>
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='favicon.ico') }}"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <header
      class="w-screen h-14 bg-white flex justify-between items-center shadow shadow-md"
    >
      <a href="/" class="flex flex-row items-center mx-8">
        <img src="static/codevuln.png" class="w-8" />
        <p class="font-bold text-2xl">Result</p>
      </a>
      <div class="flex flex-row items-center mx-8 space-x-8">
        <a href="/result" class="font-bold text2xl text-blue-500">Result</a>
        <a href="/dashboard" class="font-bold text2xl hover:text-blue-500"
          >Dashboard</a
        >
        <a href="/setting" class="font-bold text2xl hover:text-blue-500"
          >Setting</a
        >
      </div>
    </header>
    <div class="flex flex-col md:mx-20 mx-4">
      <div class="mt-8 text-3xl font-bold text-blue-500">
        (/reponame/reponame/reponame/reponame)
      </div>
      <div class="mt-4 mb-2">
        <button
          class="bg-blue-500 m-1 py-1 w-32 rounded-md text-white font-semibold hover:bg-blue-700 hover:shadow-md"
          onclick="loadData('codeql_result.json')"
        >
          CodeQL
        </button>
        <button
          class="bg-blue-500 m-1 py-1 w-32 rounded-md text-white font-semibold hover:bg-blue-700 hover:shadow-md"
          onclick="loadData('semgrep_result.json')"
        >
          Semgrep
        </button>
        <button
          class="bg-blue-500 m-1 py-1 w-32 rounded-md text-white font-semibold hover:bg-blue-700 hover:shadow-md"
          onclick="loadData('sonarqube_result.json')"
        >
          SonarQube
        </button>
      </div>
      <hr class="border-blue-300 border-1 rounded-md mb-1" />
      <div id="data-container" class="bg-blue-100 rounded-md p-2 flex">
        <!-- 여기에 AJAX로 불러온 데이터의 테이블이 표시될 예정 -->
      </div>
    </div>

    <script>
      function loadData(filename) {
        $.ajax({
          url: "/get-json-data",
          data: { filename: filename },
          success: function (data) {
            var columns = []
            var table = '<table border="1"><tr>'

            if (filename === "codeql_result.json") {
              columns = [
                "Severity",
                "Path",
                "Start_Line",
                "End_Line",
                "Start_Column",
                "End_Column",
                "Message",
              ]
            } else if (filename === "semgrep_result.json") {
              if (data.length > 0) {
                columns = Object.keys(data[0])
              }
            } else if (filename === "sonarqube_result.json") {
              columns = [
                "Severity",
                "Component",
                "Start Line",
                "End Line",
                "Start Column",
                "End Column",
                "Message",
              ]
            }

            // 컬럼 헤더 추가
            columns.forEach(function (column) {
              table += `<th>${column}</th>`
            })
            table += "</tr>"

            // 데이터 행 추가
            data.forEach(function (row) {
              table += "<tr>"
              columns.forEach(function (column) {
                var value = row[column] || row["Path"]
                table += `<td>${value}</td>`
              })
              table += "</tr>"
            })

            table += "</table>"
            $("#data-container").html(table)
          },
        })
      }

      // 초기 로드 시 'codeql_result.json' 데이터 로드
      $(document).ready(function () {
        loadData("codeql_result.json")
      })
    </script>
  </body>
</html>
